(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{4771:function(e,t,s){Promise.resolve().then(s.bind(s,1768))},1768:function(e,t,s){"use strict";s.r(t);var a=s(7437),n=s(2265),i=s(5630),l=s.n(i),r=s(2333),o=s(2749),c=s(4033),u=s(6691),p=s.n(u);let d=async()=>{let e=await fetch("/api/posts"),t=await e.json();return{data:t,error:null}};t.default=()=>{let{data:e,mutate:t,error:s,isValidating:i}=(0,r.ZP)("/api/posts",d),{data:u,status:_}=(0,o.useSession)(),m=(0,c.useRouter)();if((0,n.useEffect)(()=>{"unauthenticated"===_&&(null==m||m.push("/dashboard/login"))},[_,m]),"loading"===_)return(0,a.jsx)("p",{children:"Loading..."});let h=async e=>{e.preventDefault();let s=e.currentTarget,a=s.elements[0].value,n=s.elements[1].value,i=s.elements[2].value,l=s.elements[3].value;try{(null==u?void 0:u.user)?(await fetch("/api/posts",{method:"POST",body:JSON.stringify({title:a,desc:n,img:i,content:l,username:u.user.name})}),t(),e.currentTarget.reset()):console.error("Error: sessionData or sessionData.user is undefined.")}catch(e){console.error(e)}},g=async e=>{try{await fetch("/api/posts/".concat(e),{method:"DELETE"}),t()}catch(e){console.error(e)}};return"authenticated"===_?(0,a.jsxs)("div",{className:l().container,children:[(null==u?void 0:u.user)&&(0,a.jsxs)("div",{className:l().user,children:["Welcome ",u.user.name]}),(0,a.jsx)("div",{className:l().posts,children:i?"loading":null==e?void 0:e.data.map(e=>(0,a.jsxs)("div",{className:l().post,children:[(0,a.jsx)("div",{className:l().imgContainer,children:(0,a.jsx)(p(),{src:e.img,alt:"",width:200,height:100})}),(0,a.jsx)("h2",{className:l().postTitle,children:e.title}),(0,a.jsx)("span",{className:l().delete,onClick:()=>g(e._id),children:"X"})]},e._id))}),(0,a.jsxs)("form",{className:l().new,onSubmit:h,children:[(0,a.jsx)("h1",{className:l().formTitle,children:"Add New Post"}),(0,a.jsx)("input",{type:"text",placeholder:"Title",className:l().input}),(0,a.jsx)("input",{type:"text",placeholder:"Desc",className:l().input}),(0,a.jsx)("input",{type:"text",placeholder:"Image",className:l().input}),(0,a.jsx)("textarea",{placeholder:"Content",className:l().textArea,cols:30,rows:10}),(0,a.jsx)("button",{type:"submit",className:l().button,children:"Send"})]})]}):null}},5630:function(e){e.exports={container:"page_container__WJamO",user:"page_user__pgWxi",formTitle:"page_formTitle__egJ1g",posts:"page_posts__eax_C",post:"page_post__pXkpz",imgContainer:"page_imgContainer__jS3d9",img:"page_img__us61D",delete:"page_delete__kVuRb",new:"page_new__XOsfM",input:"page_input__olAOO",textArea:"page_textArea__29HOB",button:"page_button__4CD3K"}}},function(e){e.O(0,[964,749,483,971,12,744],function(){return e(e.s=4771)}),_N_E=e.O()}]);